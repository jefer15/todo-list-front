<div class="p-6 space-y-6 bg-gray-300 min-h-screen">

  <header class="w-full bg-[#4b5172] text-white shadow-md rounded-2xl mb-6">
    <div class="flex justify-between items-center px-6 py-4">
      <h1 class="text-xl font-bold">Gestión de Deudas</h1>

      <button mat-button (click)="logout()"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center shadow-md transition duration-300 ease-in-out">
        <mat-icon>logout</mat-icon>
        <span class="ml-2">Cerrar sesión</span>
      </button>
    </div>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" *ngIf="summary">
    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-blue-500">
      <div class="text-2xl font-bold text-gray-800">{{ summary.total}}</div>
      <div class="text-gray-600 text-sm uppercase font-semibold">Total tareas</div>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-red-500">
      <div class="text-2xl font-bold text-gray-800">{{ summary.pending }}</div>
      <div class="text-gray-600 text-sm uppercase font-semibold">Pendientes</div>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500">
      <div class="text-2xl font-bold text-gray-800">{{ summary.completed}}</div>
      <div class="text-gray-600 text-sm uppercase font-semibold">Completadas</div>
    </div>
  </div>

  <div class="flex justify-between items-center mb-6">
    <button mat-raised-button (click)="addTask()"
      class="bg-[#4b5172] hover:bg-[#3d4259] text-white px-6 py-3 rounded-lg flex items-center shadow-md transition duration-300 ease-in-out transform hover:scale-105">
      <mat-icon>add</mat-icon>
      <span class="ml-2">Añadir tarea</span>
    </button>

    <div class="flex items-center space-x-4">
      <div class="bg-white">
        <button mat-button [matMenuTriggerFor]="filterMenu"
          class="bg-white px-4 py-2 rounded-lg flex items-center shadow-md transition duration-300 ease-in-out">
          <mat-icon>filter_list</mat-icon>
          <span class="ml-2">Filtrar</span>
        </button>

        <mat-menu #filterMenu="matMenu" class="filter-menu">
          <button mat-menu-item (click)="onFilterChange('all')">
            <span class="text-white font-bold">Todas</span>
          </button>
          <button mat-menu-item (click)="onFilterChange('pending')">
            <span class="text-yellow-600 font-bold">Pendientes</span>
          </button>
          <button mat-menu-item (click)="onFilterChange('completed')">
            <span class="text-green-600 font-bold">Completadas</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>

  <div class="overflow-x-auto rounded-lg shadow-lg">
    <table mat-table [dataSource]="dataSource" matSort class="w-full">

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">ID</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap text-sm text-white">{{ row.id }}</td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">Título</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap text-sm text-white">{{ row.title }}</td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">Descripción</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap text-sm text-white">{{ row.description
          }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">Estado</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap">
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
            [class]="row.isCompleted  ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'">
            {{ row.isCompleted  ? 'Completada' : 'Pendiente' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">Usuario</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap text-sm text-white">{{ row.user.name
          }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef
          class="px-6 py-4 text-left text-sm font-semibold text-white uppercase bg-gray-100">Acciones</th>
        <td mat-cell *matCellDef="let row" class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <button mat-icon-button [matMenuTriggerFor]="menu"
            class="text-gray-500 hover:text-gray-700 transition duration-300 ease-in-out">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="viewDetail(row)" class="flex items-center text-gray-700 hover:bg-gray-100">
              <mat-icon class="mr-2">notes</mat-icon>
              <span>Ver detalle</span>
            </button>
            <button mat-menu-item (click)="updateStatusTask(row)" *ngIf="!row.paid"
              class="flex items-center text-gray-700 hover:bg-gray-100">
              <mat-icon class="mr-2">change_circle</mat-icon>
              <span>Marcar como pagada</span>
            </button>
            <button mat-menu-item (click)="editTask(row)" *ngIf="!row.paid"
              class="flex items-center text-gray-700 hover:bg-gray-100">
              <mat-icon class="mr-2">edit</mat-icon>
              <span>Editar</span>
            </button>
            <button mat-menu-item (click)="deleteTask(row)" *ngIf="!row.paid"
              class="flex items-center text-gray-700 hover:bg-gray-100">
              <mat-icon class="mr-2">delete</mat-icon>
              <span>Eliminar</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-100"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        class="hover:bg-gray-600 transition duration-300 ease-in-out"></tr>
    </table>
  </div>

  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" class="mt-6 bg-white rounded-lg shadow-md"></mat-paginator>
</div>
